<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Công cụ tính thuế thu nhập cá nhân 2026 - So sánh luật cũ và mới">
    <title>Tính Lương & Thuế TNCN 2026</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;600;700&family=JetBrains+Mono:wght@500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        :root {
            --bg-start: #f0f4ff;
            --bg-end: #e8f5e9;
            --card: #ffffff;
            --card-hover: #fafbff;
            --border: #e2e8f0;
            --border-light: #f1f5f9;

            --text-primary: #1a1f36;
            --text-secondary: #525f7f;
            --text-muted: #8898aa;

            --blue-50: #eff6ff;
            --blue-100: #dbeafe;
            --blue-400: #60a5fa;
            --blue-500: #3b82f6;
            --blue-600: #2563eb;
            --blue-700: #1d4ed8;

            --green-50: #ecfdf5;
            --green-100: #d1fae5;
            --green-400: #34d399;
            --green-500: #10b981;
            --green-600: #059669;
            --green-700: #047857;

            --orange-400: #fb923c;
            --orange-500: #f97316;
            --red-500: #ef4444;

            --radius-sm: 10px;
            --radius-md: 14px;
            --radius-lg: 20px;

            --shadow-sm: 0 1px 3px rgba(0,0,0,0.04), 0 1px 2px rgba(0,0,0,0.06);
            --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.08), 0 2px 4px -2px rgba(0,0,0,0.04);
            --shadow-lg: 0 10px 25px -5px rgba(0,0,0,0.1), 0 8px 10px -6px rgba(0,0,0,0.04);
            --shadow-card: 0 4px 20px -2px rgba(59, 130, 246, 0.08), 0 2px 8px -2px rgba(0,0,0,0.04);
            --shadow-card-hover: 0 8px 30px -4px rgba(59, 130, 246, 0.15), 0 4px 12px -4px rgba(0,0,0,0.06);
            --shadow-green: 0 4px 20px -2px rgba(16, 185, 129, 0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Be Vietnam Pro', -apple-system, sans-serif;
            background: #F9FAFC;
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.5;
        }

        /* Left Column Header Card - Same style as input card */
        .header-card {
            background: var(--card);
            border-radius: var(--radius-lg);
            border: 1px solid rgba(226, 232, 240, 0.8);
            box-shadow: var(--shadow-card);
            margin-bottom: 16px;
            transition: all 0.3s ease;
        }

        .header-card:hover {
            box-shadow: var(--shadow-card-hover);
            transform: translateY(-2px);
        }

        .header-card-inner {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 18px 22px;
            background: linear-gradient(to bottom, rgba(248, 250, 252, 0.5), transparent);
        }

        .logo-icon {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, var(--blue-50), var(--blue-100));
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--blue-600);
            flex-shrink: 0;
        }

        .logo-icon svg {
            width: 18px;
            height: 18px;
        }

        .logo-text h1 {
            font-size: 15px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .logo-text p {
            font-size: 11px;
            color: var(--text-muted);
            margin-top: 2px;
        }

        /* Main Layout */
        main {
            max-width: 1400px;
            margin: 0 auto;
            padding: 28px;
            display: grid;
            grid-template-columns: 400px 1fr;
            gap: 28px;
            align-items: start;
            position: relative;
            z-index: 1;
        }

        .left-column {
            display: flex;
            flex-direction: column;
        }

        @media (max-width: 1024px) {
            main {
                grid-template-columns: 1fr;
                padding: 20px;
            }
        }

        /* Cards */
        .card {
            background: var(--card);
            border-radius: var(--radius-lg);
            border: 1px solid rgba(226, 232, 240, 0.8);
            box-shadow: var(--shadow-card);
            transition: all 0.3s ease;
        }

        .card:hover {
            box-shadow: var(--shadow-card-hover);
            transform: translateY(-2px);
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 18px 22px;
            border-bottom: 1px solid var(--border-light);
            background: linear-gradient(to bottom, rgba(248, 250, 252, 0.5), transparent);
        }

        .card-header-icon {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, var(--blue-50), var(--blue-100));
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--blue-600);
        }

        .card-header-icon svg {
            width: 18px;
            height: 18px;
        }

        .card-header h2 {
            font-size: 15px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .card-body {
            padding: 22px;
        }

        /* Input Groups */
        .input-group {
            margin-bottom: 20px;
        }

        .input-group:last-child {
            margin-bottom: 0;
        }

        .input-label {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .input-label svg {
            width: 14px;
            height: 14px;
        }

        .input-wrapper {
            position: relative;
        }

        .input-field {
            width: 100%;
            padding: 14px 16px;
            padding-right: 55px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 20px;
            font-weight: 600;
            border: 1.5px solid var(--border);
            border-radius: var(--radius-md);
            background: linear-gradient(to bottom, #ffffff, #fafbfc);
            color: var(--text-primary);
            transition: all 0.25s ease;
        }

        .input-field:focus {
            outline: none;
            border-color: var(--blue-400);
            background: white;
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.12), 0 2px 8px rgba(59, 130, 246, 0.08);
        }

        .input-field::placeholder {
            color: var(--text-muted);
            font-weight: 500;
        }

        .input-suffix {
            position: absolute;
            right: 14px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 12px;
            font-weight: 700;
            color: var(--blue-600);
            background: linear-gradient(135deg, var(--blue-50), var(--blue-100));
            padding: 5px 10px;
            border-radius: 6px;
        }

        .input-hint {
            font-size: 11px;
            color: var(--text-muted);
            margin-top: 6px;
        }

        /* Counter */
        .counter-row {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .counter-control {
            display: flex;
            align-items: stretch;
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            overflow: hidden;
            background: white;
        }

        .counter-btn {
            width: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.15s;
        }

        .counter-btn:hover {
            background: var(--border-light);
            color: var(--blue-500);
        }

        .counter-btn svg {
            width: 16px;
            height: 16px;
        }

        .counter-input {
            width: 50px;
            text-align: center;
            font-family: 'JetBrains Mono', monospace;
            font-size: 16px;
            font-weight: 600;
            border: none;
            border-left: 1px solid var(--border);
            border-right: 1px solid var(--border);
            background: white;
            color: var(--text-primary);
            padding: 10px 0;
            -moz-appearance: textfield;
        }

        .counter-input::-webkit-outer-spin-button,
        .counter-input::-webkit-inner-spin-button {
            -webkit-appearance: none;
        }

        .counter-input:focus {
            outline: none;
        }

        /* Region Grid */
        .region-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .region-option {
            position: relative;
            padding: 14px 16px;
            border: 1.5px solid var(--border);
            border-radius: var(--radius-md);
            background: linear-gradient(to bottom, #ffffff, #fafbfc);
            cursor: pointer;
            transition: all 0.25s ease;
        }

        .region-option:hover {
            border-color: var(--blue-400);
            background: white;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.08);
        }

        .region-option.active {
            border-color: var(--blue-500);
            background: linear-gradient(135deg, var(--blue-50), #ffffff);
            box-shadow: 0 4px 16px rgba(59, 130, 246, 0.15), inset 0 1px 0 rgba(255,255,255,0.8);
        }

        .region-option input {
            position: absolute;
            opacity: 0;
        }

        .region-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 6px;
        }

        .region-name {
            font-size: 14px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .region-option.active .region-name {
            color: var(--blue-700);
        }

        .region-radio {
            width: 20px;
            height: 20px;
            border: 2px solid var(--border);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.25s ease;
            background: white;
        }

        .region-option.active .region-radio {
            border-color: var(--blue-500);
            background: var(--blue-500);
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
        }

        .region-radio::after {
            content: '';
            width: 8px;
            height: 8px;
            background: white;
            border-radius: 50%;
            opacity: 0;
            transform: scale(0);
            transition: all 0.2s ease;
        }

        .region-option.active .region-radio::after {
            opacity: 1;
            transform: scale(1);
        }

        .region-meta {
            font-size: 10px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.03em;
        }

        .region-amount {
            font-family: 'JetBrains Mono', monospace;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
        }

        /* Right Column */
        .right-column {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* Results Grid */
        .results-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 640px) {
            .results-grid {
                grid-template-columns: 1fr;
            }
        }

        .result-card {
            background: var(--card);
            border-radius: var(--radius-lg);
            border: 1px solid rgba(226, 232, 240, 0.8);
            padding: 22px;
            position: relative;
            box-shadow: var(--shadow-card);
            transition: all 0.3s ease;
        }

        .result-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-card-hover);
        }

        .result-card--new {
            border-color: var(--green-400);
            border-width: 2px;
            background: linear-gradient(135deg, #ffffff 0%, var(--green-50) 100%);
            box-shadow: var(--shadow-green);
        }

        .result-card--new:hover {
            box-shadow: 0 8px 30px -4px rgba(16, 185, 129, 0.25);
        }

        .result-badge {
            display: inline-block;
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            padding: 5px 12px;
            border-radius: 6px;
            margin-bottom: 14px;
        }

        .result-badge--old {
            background: linear-gradient(135deg, #f1f5f9, #e2e8f0);
            color: var(--text-secondary);
        }

        .result-badge--new {
            background: linear-gradient(135deg, var(--green-400), var(--green-500));
            color: white;
            box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
        }

        .result-label {
            font-size: 13px;
            color: var(--text-muted);
            margin-bottom: 6px;
        }

        .result-amount {
            font-family: 'JetBrains Mono', monospace;
            font-size: 34px;
            font-weight: 700;
            margin-bottom: 18px;
        }

        .result-card--old .result-amount {
            color: var(--text-primary);
        }

        .result-card--new .result-amount {
            color: var(--green-600);
            text-shadow: 0 2px 4px rgba(16, 185, 129, 0.1);
        }

        .result-amount .currency {
            font-size: 22px;
            margin-left: 2px;
            opacity: 0.7;
        }

        .result-details {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .result-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 13px;
        }

        .result-row-label {
            color: var(--text-muted);
        }

        .result-row-value {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
        }

        .result-card--old .result-row-value {
            color: var(--text-secondary);
        }

        .result-card--new .result-row-value {
            color: var(--green-600);
        }

        /* Savings Badge */
        .savings-box {
            margin-top: 18px;
            padding: 14px 16px;
            background: linear-gradient(135deg, var(--green-50), rgba(16, 185, 129, 0.1));
            border: 1px solid var(--green-100);
            border-radius: var(--radius-md);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .savings-label {
            font-size: 12px;
            font-weight: 500;
            color: var(--green-700);
        }

        .savings-value {
            display: flex;
            align-items: center;
            gap: 4px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 14px;
            font-weight: 700;
            color: var(--green-600);
        }

        .savings-value svg {
            width: 16px;
            height: 16px;
        }

        /* Chart Card */
        .chart-card {
            background: var(--card);
            border-radius: var(--radius-lg);
            border: 1px solid rgba(226, 232, 240, 0.8);
            padding: 24px;
            box-shadow: var(--shadow-card);
            transition: all 0.3s ease;
        }

        .chart-card:hover {
            box-shadow: var(--shadow-card-hover);
        }

        .chart-title {
            font-size: 15px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 24px;
        }

        .chart-container {
            height: 200px;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            gap: 70px;
            padding-bottom: 30px;
            position: relative;
        }

        .chart-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .chart-bars {
            display: flex;
            gap: 10px;
            align-items: flex-end;
            height: 140px;
        }

        .chart-bar {
            width: 55px;
            border-radius: 6px 6px 0 0;
            position: relative;
            transition: height 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .chart-bar--old {
            background: linear-gradient(180deg, #cbd5e1 0%, #94a3b8 100%);
        }

        .chart-bar--new {
            background: linear-gradient(180deg, var(--green-400) 0%, var(--green-600) 100%);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }

        .chart-bar-value {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px;
            font-weight: 600;
            color: var(--text-secondary);
            white-space: nowrap;
            margin-bottom: 6px;
        }

        .chart-label {
            font-size: 12px;
            color: var(--text-muted);
            text-align: center;
            font-weight: 500;
        }

        .chart-legend {
            display: flex;
            justify-content: center;
            gap: 28px;
            margin-top: 20px;
            padding-top: 16px;
            border-top: 1px solid var(--border-light);
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .legend-dot {
            width: 14px;
            height: 14px;
            border-radius: 4px;
        }

        .legend-dot--old {
            background: linear-gradient(180deg, #cbd5e1 0%, #94a3b8 100%);
        }

        .legend-dot--new {
            background: linear-gradient(180deg, var(--green-400) 0%, var(--green-600) 100%);
            box-shadow: 0 2px 6px rgba(16, 185, 129, 0.3);
        }

        /* Detail Cards */
        .details-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 768px) {
            .details-grid {
                grid-template-columns: 1fr;
            }
        }

        .detail-card {
            background: var(--card);
            border-radius: var(--radius-lg);
            border: 1px solid rgba(226, 232, 240, 0.8);
            padding: 22px;
            box-shadow: var(--shadow-card);
            transition: all 0.3s ease;
        }

        .detail-card:hover {
            box-shadow: var(--shadow-card-hover);
        }

        .detail-card h3 {
            font-size: 15px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 6px;
        }

        .detail-card p {
            font-size: 12px;
            color: var(--text-muted);
            margin-bottom: 18px;
        }

        .detail-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }

        .detail-table th {
            text-align: left;
            padding: 10px 0;
            font-weight: 600;
            color: var(--text-muted);
            border-bottom: 1px solid var(--border);
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.04em;
        }

        .detail-table th:not(:first-child) {
            text-align: right;
        }

        .detail-table td {
            padding: 10px 0;
            color: var(--text-secondary);
            border-bottom: 1px solid var(--border-light);
        }

        .detail-table td:not(:first-child) {
            text-align: right;
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
        }

        .detail-table .text-green {
            color: var(--green-600);
            font-weight: 600;
        }

        .detail-table .text-red {
            color: var(--red-500);
        }

        .detail-table .text-bold {
            font-weight: 700;
            color: var(--text-primary);
        }

        /* Info Box */
        .info-box {
            background: linear-gradient(135deg, var(--blue-50), rgba(59, 130, 246, 0.08));
            border: 1px solid var(--blue-100);
            border-radius: var(--radius-md);
            padding: 16px 18px;
            display: flex;
            gap: 12px;
            margin-top: 22px;
        }

        .info-box svg {
            width: 18px;
            height: 18px;
            color: var(--blue-500);
            flex-shrink: 0;
        }

        .info-box-content h4 {
            font-size: 13px;
            font-weight: 600;
            color: var(--blue-600);
            margin-bottom: 2px;
        }

        .info-box-content p {
            font-size: 12px;
            color: var(--blue-600);
            opacity: 0.8;
        }

        /* Responsive */
        @media (max-width: 768px) {
            main {
                padding: 16px;
            }


            .result-amount {
                font-size: 26px;
            }
        }
    </style>
</head>
<body>

    <main>
        <!-- Left Column: Header + Inputs -->
        <div class="left-column">
            <!-- Header Card (same style as input card) -->
            <div class="header-card">
                <div class="header-card-inner">
                    <div class="logo-icon">
                        <i data-lucide="trending-up"></i>
                    </div>
                    <div class="logo-text">
                        <h1>Tính Lương/ Thuế TNCN 2026</h1>
                        <p>So sánh luật cũ & mới (Hiệu lực 1/1/2026)</p>
                    </div>
                </div>
            </div>

            <!-- Input Card -->
            <div class="card">
            <div class="card-header">
                <div class="card-header-icon">
                    <i data-lucide="file-text"></i>
                </div>
                <h2>Nhập thông tin lương</h2>
            </div>
            <div class="card-body">
                <!-- Salary Input -->
                <div class="input-group">
                    <label class="input-label">Tổng thu nhập (Gross) / Tháng (VND)</label>
                    <div class="input-wrapper">
                        <input
                            type="text"
                            id="salary"
                            class="input-field"
                            placeholder="0"
                            inputmode="numeric"
                            autocomplete="off"
                            autofocus>
                        <span class="input-suffix">VND</span>
                    </div>
                    <p class="input-hint">Lương tổng chưa trừ bảo hiểm và thuế</p>
                </div>

                <!-- Dependents -->
                <div class="input-group">
                    <label class="input-label">
                        <i data-lucide="users"></i>
                        Số người phụ thuộc
                    </label>
                    <div class="counter-row">
                        <div class="counter-control">
                            <button type="button" class="counter-btn" data-action="decrement">
                                <i data-lucide="minus"></i>
                            </button>
                            <input
                                type="number"
                                id="dependents"
                                class="counter-input"
                                value="0"
                                min="0"
                                max="10">
                            <button type="button" class="counter-btn" data-action="increment">
                                <i data-lucide="plus"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Region -->
                <div class="input-group">
                    <label class="input-label">Vùng lương tối thiểu</label>
                    <div class="region-grid" id="region-grid">
                        <label class="region-option active" data-region="I">
                            <input type="radio" name="region" value="I" checked>
                            <div class="region-header">
                                <span class="region-name">Vùng I</span>
                                <span class="region-radio"></span>
                            </div>
                            <div class="region-meta">MỨC TỐI THIỂU:</div>
                            <div class="region-amount">5.310.000</div>
                        </label>
                        <label class="region-option" data-region="II">
                            <input type="radio" name="region" value="II">
                            <div class="region-header">
                                <span class="region-name">Vùng II</span>
                                <span class="region-radio"></span>
                            </div>
                            <div class="region-meta">MỨC TỐI THIỂU:</div>
                            <div class="region-amount">4.730.000</div>
                        </label>
                        <label class="region-option" data-region="III">
                            <input type="radio" name="region" value="III">
                            <div class="region-header">
                                <span class="region-name">Vùng III</span>
                                <span class="region-radio"></span>
                            </div>
                            <div class="region-meta">MỨC TỐI THIỂU:</div>
                            <div class="region-amount">4.140.000</div>
                        </label>
                        <label class="region-option" data-region="IV">
                            <input type="radio" name="region" value="IV">
                            <div class="region-header">
                                <span class="region-name">Vùng IV</span>
                                <span class="region-radio"></span>
                            </div>
                            <div class="region-meta">MỨC TỐI THIỂU:</div>
                            <div class="region-amount">3.700.000</div>
                        </label>
                    </div>
                </div>

                <!-- Info Box -->
                <div class="info-box">
                    <i data-lucide="info"></i>
                    <div class="info-box-content">
                        <h4>Thông tin giảm trừ mới (từ 1/1/2026)</h4>
                        <p>Bản thân: 15.5 triệu · Người phụ thuộc: 6.2 triệu/người</p>
                    </div>
                </div>
            </div>
            </div>
        </div>

        <!-- Right Column: Results -->
        <div class="right-column">
            <!-- Result Cards -->
            <div class="results-grid">
                <!-- Old Law -->
                <div class="result-card result-card--old">
                    <span class="result-badge result-badge--old">QUY ĐỊNH CŨ</span>
                    <div class="result-label">Thực lĩnh (Net)</div>
                    <div class="result-amount" id="old-net">0<span class="currency">đ</span></div>
                    <div class="result-details">
                        <div class="result-row">
                            <span class="result-row-label">Thuế phải đóng:</span>
                            <span class="result-row-value" id="old-tax">0 đ</span>
                        </div>
                        <div class="result-row">
                            <span class="result-row-label">Tổng giảm trừ:</span>
                            <span class="result-row-value" id="old-deduction">0 đ</span>
                        </div>
                    </div>
                </div>

                <!-- New Law -->
                <div class="result-card result-card--new">
                    <span class="result-badge result-badge--new">MỚI (SAU 1/1/2026)</span>
                    <div class="result-label">Thực lĩnh (Net)</div>
                    <div class="result-amount" id="new-net">0<span class="currency">đ</span></div>
                    <div class="result-details">
                        <div class="result-row">
                            <span class="result-row-label">Thuế phải đóng:</span>
                            <span class="result-row-value" id="new-tax">0 đ</span>
                        </div>
                        <div class="result-row">
                            <span class="result-row-label">Tổng giảm trừ:</span>
                            <span class="result-row-value" id="new-deduction">0 đ</span>
                        </div>
                    </div>
                    <div class="savings-box">
                        <span class="savings-label">Bạn tiết kiệm được:</span>
                        <span class="savings-value" id="savings-value">
                            0 đ
                            <i data-lucide="trending-up"></i>
                        </span>
                    </div>
                </div>
            </div>

            <!-- Chart -->
            <div class="chart-card">
                <h3 class="chart-title">Biểu đồ so sánh</h3>
                <div class="chart-container">
                    <div class="chart-group">
                        <div class="chart-bars">
                            <div class="chart-bar chart-bar--old" id="chart-tax-old" style="height: 0px;">
                                <span class="chart-bar-value" id="chart-tax-old-val">0</span>
                            </div>
                            <div class="chart-bar chart-bar--new" id="chart-tax-new" style="height: 0px;">
                                <span class="chart-bar-value" id="chart-tax-new-val">0</span>
                            </div>
                        </div>
                        <span class="chart-label">Thuế phải đóng (Tháng)</span>
                    </div>
                    <div class="chart-group">
                        <div class="chart-bars">
                            <div class="chart-bar chart-bar--old" id="chart-net-old" style="height: 0px;">
                                <span class="chart-bar-value" id="chart-net-old-val">0</span>
                            </div>
                            <div class="chart-bar chart-bar--new" id="chart-net-new" style="height: 0px;">
                                <span class="chart-bar-value" id="chart-net-new-val">0</span>
                            </div>
                        </div>
                        <span class="chart-label">Thực lĩnh (Net)</span>
                    </div>
                </div>
                <div class="chart-legend">
                    <div class="legend-item">
                        <span class="legend-dot legend-dot--old"></span>
                        Quy định cũ
                    </div>
                    <div class="legend-item">
                        <span class="legend-dot legend-dot--new"></span>
                        Quy định mới
                    </div>
                </div>
            </div>

            <!-- Details -->
            <div class="details-grid">
                <div class="detail-card">
                    <h3>Diễn giải chi tiết (VNĐ)</h3>
                    <p id="region-info">Áp dụng vùng I - Mức lương tối thiểu 5.310.000 đ</p>
                    <table class="detail-table">
                        <thead>
                            <tr>
                                <th>Khoản mục</th>
                                <th>Cũ</th>
                                <th>Mới</th>
                            </tr>
                        </thead>
                        <tbody id="details-body"></tbody>
                    </table>
                </div>
                <div class="detail-card">
                    <h3>(*) Chi tiết thuế thu nhập cá nhân (VNĐ)</h3>
                    <p>Diễn giải theo từng bậc lũy tiến</p>
                    <table class="detail-table">
                        <thead>
                            <tr>
                                <th>Bậc</th>
                                <th>Thuế suất</th>
                                <th>Cũ</th>
                                <th>Mới</th>
                            </tr>
                        </thead>
                        <tbody id="bracket-body"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <script>
        lucide.createIcons();

        // ========================================
        // Constants
        // ========================================

        const VND = {
            format: (n) => typeof n === 'number' && !isNaN(n) ? Math.round(n).toLocaleString('vi-VN') : '0',
            formatUnit: (n) => VND.format(n) + ' đ',
            formatShort: (n) => {
                if (n >= 1000000) return (n / 1000000).toFixed(1) + 'M';
                if (n >= 1000) return (n / 1000).toFixed(0) + 'K';
                return n.toString();
            },
            parse: (s) => parseInt(String(s).replace(/[^\d]/g, ''), 10) || 0
        };

        const TAX_OLD = {
            BRACKETS: [
                { upper: 5_000_000, rate: 0.05 },
                { upper: 10_000_000, rate: 0.10 },
                { upper: 18_000_000, rate: 0.15 },
                { upper: 32_000_000, rate: 0.20 },
                { upper: 52_000_000, rate: 0.25 },
                { upper: 80_000_000, rate: 0.30 },
                { upper: Infinity, rate: 0.35 }
            ],
            PERSONAL: 11_000_000,
            DEPENDENT: 4_400_000
        };

        const TAX_NEW = {
            BRACKETS: [
                { upper: 10_000_000, rate: 0.05 },
                { upper: 30_000_000, rate: 0.10 },
                { upper: 60_000_000, rate: 0.20 },
                { upper: 100_000_000, rate: 0.30 },
                { upper: Infinity, rate: 0.35 }
            ],
            PERSONAL: 15_500_000,
            DEPENDENT: 6_200_000
        };

        const REGIONS = {
            I: { min: 5_310_000, label: 'I' },
            II: { min: 4_730_000, label: 'II' },
            III: { min: 4_140_000, label: 'III' },
            IV: { min: 3_700_000, label: 'IV' }
        };

        const BASE_WAGE = 5_310_000;
        const CAP_MULT = 20;

        // ========================================
        // Calculations
        // ========================================

        function calcTax(income, brackets) {
            if (income <= 0) return 0;
            let tax = 0, prev = 0;
            for (const b of brackets) {
                if (income > b.upper) {
                    tax += (b.upper - prev) * b.rate;
                    prev = b.upper;
                } else {
                    tax += (income - prev) * b.rate;
                    break;
                }
            }
            return Math.round(tax);
        }

        function calcInsurance(gross, region) {
            const nationalCap = BASE_WAGE * CAP_MULT;
            const regionalCap = REGIONS[region].min * CAP_MULT;
            const si = Math.min(gross * 0.08, nationalCap * 0.08);
            const hi = Math.min(gross * 0.015, nationalCap * 0.015);
            const ui = Math.min(gross * 0.01, regionalCap * 0.01);
            return Math.round(si + hi + ui);
        }

        function grossToNet(gross, deps, region, tax) {
            const ins = calcInsurance(gross, region);
            const deduct = tax.PERSONAL + tax.DEPENDENT * deps;
            const taxable = Math.max(0, gross - ins - deduct);
            const taxAmt = calcTax(taxable, tax.BRACKETS);
            return { gross, ins, deduct, taxable, tax: taxAmt, net: Math.round(gross - ins - taxAmt) };
        }

        function getTaxBreakdown(income, brackets) {
            if (income <= 0) return [];
            const result = [];
            let prev = 0;
            for (let i = 0; i < brackets.length; i++) {
                const b = brackets[i];
                if (income > prev) {
                    const amt = Math.min(income - prev, b.upper - prev);
                    result.push({ rate: `${b.rate * 100}%`, tax: Math.round(amt * b.rate) });
                    prev = b.upper;
                    if (income <= b.upper) break;
                }
            }
            return result;
        }

        // ========================================
        // State & UI
        // ========================================

        const state = { salary: 0, deps: 0, region: 'I' };

        const $ = (id) => document.getElementById(id);
        const els = {
            salary: $('salary'),
            deps: $('dependents'),
            regionGrid: $('region-grid'),
            regionInfo: $('region-info'),
            oldNet: $('old-net'),
            oldTax: $('old-tax'),
            oldDeduct: $('old-deduction'),
            newNet: $('new-net'),
            newTax: $('new-tax'),
            newDeduct: $('new-deduction'),
            savings: $('savings-value'),
            details: $('details-body'),
            brackets: $('bracket-body'),
            chartTaxOld: $('chart-tax-old'),
            chartTaxNew: $('chart-tax-new'),
            chartNetOld: $('chart-net-old'),
            chartNetNew: $('chart-net-new'),
            chartTaxOldVal: $('chart-tax-old-val'),
            chartTaxNewVal: $('chart-tax-new-val'),
            chartNetOldVal: $('chart-net-old-val'),
            chartNetNewVal: $('chart-net-new-val')
        };

        function updateChart(oldR, newR) {
            const maxTax = Math.max(oldR.tax, newR.tax, 1);
            const maxNet = Math.max(oldR.net, newR.net, 1);
            const maxHeight = 120;

            els.chartTaxOld.style.height = Math.max(4, (oldR.tax / maxTax) * maxHeight) + 'px';
            els.chartTaxNew.style.height = Math.max(4, (newR.tax / maxTax) * maxHeight) + 'px';
            els.chartNetOld.style.height = Math.max(4, (oldR.net / maxNet) * maxHeight) + 'px';
            els.chartNetNew.style.height = Math.max(4, (newR.net / maxNet) * maxHeight) + 'px';

            els.chartTaxOldVal.textContent = VND.formatShort(oldR.tax);
            els.chartTaxNewVal.textContent = VND.formatShort(newR.tax);
            els.chartNetOldVal.textContent = VND.formatShort(oldR.net);
            els.chartNetNewVal.textContent = VND.formatShort(newR.net);
        }

        function update() {
            const oldR = grossToNet(state.salary, state.deps, state.region, TAX_OLD);
            const newR = grossToNet(state.salary, state.deps, state.region, TAX_NEW);
            const save = newR.net - oldR.net;
            const hasSalary = state.salary > 0;

            els.oldNet.innerHTML = `${VND.format(oldR.net)}<span class="currency">đ</span>`;
            els.oldTax.textContent = VND.formatUnit(oldR.tax);
            els.oldDeduct.textContent = hasSalary ? VND.formatUnit(oldR.deduct) : '0 đ';

            els.newNet.innerHTML = `${VND.format(newR.net)}<span class="currency">đ</span>`;
            els.newTax.textContent = VND.formatUnit(newR.tax);
            els.newDeduct.textContent = hasSalary ? VND.formatUnit(newR.deduct) : '0 đ';

            els.savings.innerHTML = `${VND.formatUnit(Math.max(0, save))} <i data-lucide="trending-up"></i>`;
            lucide.createIcons();

            // Region info
            els.regionInfo.textContent = `Áp dụng vùng ${state.region} - Mức lương tối thiểu ${VND.format(REGIONS[state.region].min)} đ`;

            // Chart
            updateChart(oldR, newR);

            // Details table - show deductions only when salary entered
            const rows = [
                ['Lương Gross', oldR.gross, newR.gross],
                ['Bảo hiểm (10.5%)', -oldR.ins, -newR.ins],
                ['Giảm trừ bản thân', hasSalary ? -TAX_OLD.PERSONAL : 0, hasSalary ? -TAX_NEW.PERSONAL : 0],
                [`Giảm trừ NPT (×${state.deps})`, hasSalary ? -TAX_OLD.DEPENDENT * state.deps : 0, hasSalary ? -TAX_NEW.DEPENDENT * state.deps : 0],
                ['Thu nhập chịu thuế', oldR.taxable, newR.taxable],
                ['Thuế TNCN (*)', -oldR.tax, -newR.tax, 'negative'],
                ['Thực lĩnh (Net)', oldR.net, newR.net, 'bold']
            ];

            els.details.innerHTML = rows.map(([label, old, newVal, type]) => `
                <tr>
                    <td class="${type === 'bold' ? 'text-bold' : ''}">${label}</td>
                    <td class="${type === 'negative' ? 'text-red' : ''}">${VND.format(old)}</td>
                    <td class="text-green ${type === 'bold' ? 'text-bold' : ''}">${VND.format(newVal)}</td>
                </tr>
            `).join('');

            // Brackets table
            const oldBr = getTaxBreakdown(oldR.taxable, TAX_OLD.BRACKETS);
            const newBr = getTaxBreakdown(newR.taxable, TAX_NEW.BRACKETS);
            const rates = ['5%', '10%', '20%', '30%', '35%'];

            if (oldBr.length === 0 && newBr.length === 0) {
                els.brackets.innerHTML = '<tr><td colspan="4" style="text-align:center;color:var(--text-muted);padding:20px">Không có thuế</td></tr>';
            } else {
                els.brackets.innerHTML = rates.map((r, i) => {
                    const o = oldBr.find(x => x.rate === r);
                    const n = newBr.find(x => x.rate === r);
                    return `
                        <tr>
                            <td>Bậc ${i + 1}</td>
                            <td>${r}</td>
                            <td>${o ? VND.format(o.tax) : '—'}</td>
                            <td class="text-green">${n ? VND.format(n.tax) : '—'}</td>
                        </tr>
                    `;
                }).join('');
            }
        }

        // ========================================
        // Events
        // ========================================

        let timeout;
        els.salary.addEventListener('input', (e) => {
            const val = e.target.value.replace(/[^\d]/g, '');
            const num = parseInt(val, 10) || 0;
            e.target.value = num > 0 ? num.toLocaleString('vi-VN') : '';
            state.salary = num;
            clearTimeout(timeout);
            timeout = setTimeout(update, 100);
        });

        document.querySelectorAll('.counter-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                let v = parseInt(els.deps.value, 10) || 0;
                if (btn.dataset.action === 'increment' && v < 10) v++;
                if (btn.dataset.action === 'decrement' && v > 0) v--;
                els.deps.value = v;
                state.deps = v;
                update();
            });
        });

        els.deps.addEventListener('change', (e) => {
            state.deps = Math.max(0, Math.min(10, parseInt(e.target.value, 10) || 0));
            e.target.value = state.deps;
            update();
        });

        // Region selection
        els.regionGrid.querySelectorAll('.region-option').forEach(opt => {
            opt.addEventListener('click', () => {
                els.regionGrid.querySelectorAll('.region-option').forEach(o => o.classList.remove('active'));
                opt.classList.add('active');
                state.region = opt.dataset.region;
                update();
            });
        });

        update();

        // Export for testing
        window.VND = VND;
        window.grossToNet = grossToNet;
        window.calcTax = calcTax;
    </script>
</body>
</html>
